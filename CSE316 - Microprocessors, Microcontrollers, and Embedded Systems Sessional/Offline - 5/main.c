/*
 * LED Matrix Code.c
 *
 * Created: 4/22/2021 3:26:14 AM
 * Author : Arafat
 */ 

#define F_CPU 1000000UL
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

volatile int i = 0, j = 0;
volatile int currentMode = 0;
char columns[] = {
	1, 2, 4, 8, 16, 32, 64, 128
};

char rows[][8] = {
	{0xff, 0xff, 0x81, 0xF5, 0xF5, 0xFD, 0xff, 0xff},
	{0xff, 0xff, 0x3, 0xEB, 0xEB, 0xfb, 0xff, 0xff},
	{0xff, 0xff, 0x6, 0xd7, 0xd7, 0xF7, 0xff, 0xff},
	{0xff, 0xff, 0xc, 0xaf, 0xaf, 0xef, 0xff, 0xff},
	{0xff, 0xff, 0x18, 0x5f, 0x5f, 0xdf, 0xff, 0xff},
	{0xff, 0xff, 0x30, 0xbe, 0xbe, 0xbf, 0xff, 0xff},
	{0xff, 0xff, 0x60, 0x7d, 0x7d, 0x7f, 0xff, 0xff},
	{0xff, 0xff, 0xc0, 0xFa, 0xFa, 0xFe, 0xff, 0xff}
};
/*char rows[][8] = {
	{0xff, 0x81, 0xed, 0xed, 0xed, 0xed, 0xFD, 0xff},
	{0xff, 0x3,  0xdb, 0xdb, 0xdb, 0xdb, 0xfb, 0xff},
	{0xff, 0x6,  0xb7, 0xb7, 0xb7, 0xb7, 0xF7, 0xff},
	{0xff, 0xc,  0x6f, 0x6f, 0x6f, 0x6f, 0xef, 0xff},
	{0xff, 0x18, 0xde, 0xde, 0xde, 0xde, 0xdf, 0xff},
	{0xff, 0x30, 0xbd, 0xbd, 0xbd, 0xbd, 0xbf, 0xff},
	{0xff, 0x60, 0x7b, 0x7b, 0x7b, 0x7b, 0x7f, 0xff},
	{0xff, 0xc0, 0xF6, 0xF6, 0xF6, 0xF6, 0xFe, 0xff}
};*/
void staticMode(){
	PORTC = columns[i];
	PORTD = rows[j][i];
	_delay_ms(2);
	i = (i+1)%8;
}

void dynamicMode(){
	for(int k = 0; k < 120; k++){
		staticMode();
	}
	j = (j+1)%8;
}

ISR (INT2_vect){
	currentMode = !currentMode;
}

int main(void)
{
    /* Replace with your application code */
	DDRD=0xFF;
	DDRC=0xFF;

	GICR |= (1<<INT2);
	MCUCSR = 0b01000000;
	sei();
		
    while (1) 
    {
		if(!currentMode){
			staticMode();
		}else{
			dynamicMode();
		}
		
    }
}

